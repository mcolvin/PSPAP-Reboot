---
title: Gear Timing Summary
output: 
  html_document:
    includes:
      in_header: header_banner.html 
bibliography: PSref.bib
csl: ecology.csl  
---

<!---
rmarkdown::render_site("_Gear-Timing-Summary.Rmd")# build website
--->


Sturgeon sampling starts October 31 of the preceeding year and goes until October
30 of the current calendar year. Sturgeon season starts in the fall when 
water temperatures fall below 55F the maximum for gill nets and trotlines and then 
goes until June 30. 

From Integrative Science Report
Sampling occurs from October 31 of the preceding calendar year to 
October 30 of the current calendar year. Each year includes two sampling 
seasons: sturgeon-focused (Sturgeon Season; ST) and native fish 
community-focused (Fish Community Season; FC) season. Sturgeon season 
runs from fall when water temperatures are first below the maximum set 
for gill nets and trotline deployment to June 30; however, in attempts 
to minimize Pallid Sturgeon stress during collection, the sampling year 
was further defined by the restriction that gill nets and trammel nets 
could not be used above a water temperature of 12.8C (55F). Fish 
community season runs from July 1 to October 31, overlapping ST for 
water temperatures below 12.8C (55F) prior to October 31. 


## When does gear specific sampling typically occur in a year.

For the upper basin we will look at

1. GN14 and GN41
2. MF
3. OT16
4. TLC1 and TLC2
5. TN

For the lower basin we will look at

1. GN18 and 81
2. GLC4
3. TLS1 and TLS2



```{r,echo=FALSE,warning=FALSE, message=FALSE}
dat<- readRDS("output/effort-data.Rds")
UBcommon<-c("GN14","GN41","MF","OT16","TLC1","TLC2","TN")
LBcommon<-c("GN18","GN81","TLC4","TLS1","TLS2")
datS<-subset(dat,standard_gear=="yes")
datS$gear <- factor(as.character(datS$gear))
datS$doy<- as.numeric(format(datS$setdate,"%j"))
datS$doy_sample<- ifelse(datS$doy>=304, datS$doy-303, datS$doy+53)
datS$yr_sample<- ifelse(datS$doy>=304, datS$yr-1, datS$yr)

## lower basin
xxx<- subset(datS,gear%in% LBcommon & basin=="LB")
tmp<-aggregate(doy_sample~yr_sample+gear,xxx,min)
tmp$mxDoy<-aggregate(doy_sample~yr_sample+gear,xxx,max)[,-c(1:2)]

tmp$start<- tmp$yr_samp+tmp$doy_sample/365 
tmp$stop<- tmp$yr_samp+tmp$mxDoy/365
gears<- as.character(unique(tmp$gear))
plot(c(2003,2018),c(0,length(gears)),type='n',yaxt='n',ylab="",
    xlab="")
abline(v=c(2003:2017),lty=2,col="lightgrey")

for(i in 1:length(gears))
    {
    pdat<-subset(tmp, gear==gears[i])
    segments(pdat$start,i,pdat$stop,i)
    text(2010,i-0.25,gears[i])
    }
```

The upper basin fishes more gears for shorter durations. The effort
is dominated by trotlines, trammel nets, and otter trawls.  Gill 
newts were used early on but are used during a short window of for
the past 5-10 years.

```{r,echo=FALSE,warning=FALSE, message=FALSE}
## upper basin
xxx<- subset(datS,gear%in% UBcommon & basin=="UB")
tmp<-aggregate(doy_sample~yr_sample+gear,xxx,min)
tmp$mxDoy<-aggregate(doy_sample~yr_sample+gear,xxx,max)[,-c(1:2)]

tmp$start<- tmp$yr_samp+tmp$doy_sample/365 
tmp$stop<- tmp$yr_samp+tmp$mxDoy/365
gears<- as.character(unique(tmp$gear))
plot(c(2003,2018),c(0,length(gears)),type='n',yaxt='n',ylab="",
    xlab="")
abline(v=c(2003:2017),lty=2,col="lightgrey")
for(i in 1:length(gears))
    {
    pdat<-subset(tmp, gear==gears[i])
    segments(pdat$start,i,pdat$stop,i)
    text(2010,i-0.25,gears[i])
    }    
```

## Are gears fished at the same spot at the same time?

### Lower Basin

```{r,echo=FALSE,warning=FALSE, message=FALSE}
## lower basin
agg_gear<- subset(datS, basin=="LB")
agg_gear[agg_gear$gear%in%c("GN41","GN81","GN18"),]$gear<-"GN14"
agg_gear[agg_gear$gear%in%c("TLC1","TLC2","TLC3","TLC4","TLC5","TLC6","TLC7",
    "TLC8","TLS1","TLS2","TLS3"),]$gear<- "TLC1"
agg_gear$gearf<- droplevels(agg_gear$gear)
pppp<- dcast(agg_gear,yr+doy+segment_id+bend~gearf,value.var="doy",length)    

for(i in 5:ncol(pppp)){pppp[,i]<- ifelse(pppp[,i]>0,1,0)}
pppp$tmp<-rowSums(pppp[,-c(1:4)])
xx<-pppp[which(pppp$tmp>1),]
```
Some active gears like otter trawls may be fished on the same day
as passive gears are set. In the lower basin there were 54 instances
of gears being fished on the same day and bend. In all cases combinations were
limited to 2 gears.

```{r,echo=FALSE,warning=FALSE, message=FALSE}
xxx<- xx[,-c(1:4,ncol(xx))]
for(i in 1:ncol(xxx))
    {
    xxx[,i]<-ifelse(xxx[,i]==1,names(xxx)[i],NA)
    }
combos<- sapply(1:nrow(xxx),function(x) 
    {
    indx<-which(is.na(c(xxx[x,]))==FALSE) 
    paste( xxx[x,indx],collapse=" & ")
    })
kable(as.data.frame(xtabs(~combos)),col.names=c("Gear combination","Frequency"),
    align='cc')
```

### Upper Basin  

```{r,echo=FALSE,warning=FALSE, message=FALSE}
## lower basin
agg_gear<- subset(datS, basin=="UB")
agg_gear[agg_gear$gear%in%c("GN41","GN81","GN18"),]$gear<-"GN14"
agg_gear[agg_gear$gear%in%c("TLC1","TLC2","TLO1"),]$gear<- "TLC1"
agg_gear$gearf<- droplevels(agg_gear$gear)
pppp<- dcast(agg_gear,yr+doy+segment_id+bend~gearf,value.var="doy",length)    

for(i in 5:ncol(pppp)){pppp[,i]<- ifelse(pppp[,i]>0,1,0)}
pppp$tmp<-rowSums(pppp[,-c(1:4)])
xx<-pppp[which(pppp$tmp>1),]
```

More gears were fished at the same place and time in the upper basin.
There were `r nrow(xx)` 
instances of gears being fished on the same day and bend. The number of 
gears fished varied from 2 to 4. The combinations of gears set in the
same bend on the same day are summarized below.


```{r,echo=FALSE,warning=FALSE, message=FALSE}
xxx<- xx[,-c(1:4,ncol(xx))]
for(i in 1:ncol(xxx))
    {
    xxx[,i]<-ifelse(xxx[,i]==1,names(xxx)[i],NA)
    }
combos<- sapply(1:nrow(xxx),function(x) 
    {
    indx<-which(is.na(c(xxx[x,]))==FALSE) 
    paste( xxx[x,indx],collapse=" & ")
    })
kable(as.data.frame(xtabs(~combos)),col.names=c("Gear combination","Frequency"),
    align='cc')
```


 
